{
	admin off
	servers {
		protocols h1 h2 h2c
	}
	log {
		output stderr
		format console
		level DEBUG
	}
}

# Global configuration for all subdomains
*.techbrohomelab.xyz {
	# Global security headers
	header {
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		X-Frame-Options "SAMEORIGIN"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
		-X-Powered-By
	}

	handle_errors {
		respond "Error: {err.status_code} {err.status_text}"
	}
}

today.techbrohomelab.xyz {
	header {
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		X-Frame-Options "SAMEORIGIN"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
		-X-Powered-By
	}

	@api {
		path_regexp api ^/api/.*
	}
	handle @api {
		uri strip_prefix /api
		reverse_proxy today-stocks-backend:8020
	}

	handle {
		reverse_proxy today-frontend:80
	}

	handle_errors {
		respond "Error: {err.status_code} {err.status_text}"
	}
}

# Local development configuration
localhost {
	header {
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		X-Frame-Options "SAMEORIGIN"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
		-X-Powered-By
	}

	@api {
		path_regexp api ^/api/.*
	}
	handle @api {
		uri strip_prefix /api
		reverse_proxy today-stocks-backend:8020
	}

	handle {
		reverse_proxy today-frontend:80
	}

	handle_errors {
		respond "Error: {err.status_code} {err.status_text}"
	}
}
