today.techbrohomelab.xyz {
	# Security headers
	header {
		X-Frame-Options "SAMEORIGIN"
		X-XSS-Protection "1; mode=block"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
		Strict-Transport-Security "max-age=31536000; includeSubDomains"
	}

	# Trust Cloudflare headers
	trusted_proxies private_ranges

	# Handle frontend requests
	handle {
		reverse_proxy today-frontend:80 {
			health_uri /
			health_interval 30s
			health_timeout 10s
			health_status 200
			
			# Timeouts
			timeout 10s
			
			# Load balancing
			lb_try_duration 5s
			lb_try_interval 250ms
		}
	}

	# Handle backend requests
	handle /api/* {
		uri strip_prefix /api
		reverse_proxy today-backend:8020 {
			health_uri /health
			health_interval 30s
			health_timeout 10s
			health_status 200
			
			# Timeouts
			timeout 10s
			
			# Load balancing
			lb_try_duration 5s
			lb_try_interval 250ms
		}
	}

	# Error handling
	handle_errors {
		rewrite * /error.html
		file_server {
			root /usr/share/caddy/error
		}
	}
}
